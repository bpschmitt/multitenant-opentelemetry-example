# Default values for demo-app
# This is a YAML-formatted file.

# Global settings
global:
  tenantId: "default"

  # OTLP endpoint configuration
  # Set useNodeLocalEndpoint: true to use node's IP (for daemonset collectors)
  # Set useNodeLocalEndpoint: false to use a specific endpoint (for deployment collectors)
  useNodeLocalEndpoint: true
  otlpPort: "4317"  # Port for node-local endpoint
  # otlpEndpoint: "http://opentelemetry-collector.otel-collector.svc.cluster.local:4317"

  # Global image registry - if set, will be prepended to image repositories
  # Example: "docker.io/myorg" or "ghcr.io/myorg" or "myregistry.io"
  # Leave empty to use full image paths in sender/receiver.image.repository
  imageRegistry: "docker.io/bpschmitt"
  # Global image pull secrets (applied to all services)
  imagePullSecrets: []
  # Global image pull policy (can be overridden per service)
  imagePullPolicy: IfNotPresent
  
  # Global environment variables (applied to all services)
  # Can be overridden by service-specific env vars
  # Supports both value and valueFrom objects (for downward API, secrets, configmaps)
  # Example:
  #   envs:
  #     - name: COMMON_VAR
  #       value: "common-value"
  #     - name: K8S_POD_IP
  #       valueFrom:
  #         fieldRef:
  #           fieldPath: status.podIP
  envs: []


# Sender service configuration
sender:
  enabled: true
  name: sender
  image:
    # Full image repository path, or relative to global.imageRegistry if set
    # Examples:
    #   - If global.imageRegistry="docker.io/myorg": use "sender" or "myorg/sender"
    #   - If global.imageRegistry="": use "docker.io/myorg/sender" or "myorg/sender"
    repository: "myorg/sender"
    tag: "latest"
    # Override global image pull policy for this service
    pullPolicy: ""
    # Override global image pull secrets for this service
    pullSecrets: []
  replicaCount: 1
  service:
    type: ClusterIP
    port: 8000
  env:
    - name: OTEL_SERVICE_NAME
      value: "sender-service"
    - name: RECEIVER_SERVICE_URL
      value: "http://receiver-service:8000"
    - name: ERROR_RATE
      value: "0.0"
    - name: LATENCY_MS
      value: "0"
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

# Receiver service configuration
receiver:
  enabled: true
  name: receiver
  image:
    # Full image repository path, or relative to global.imageRegistry if set
    # Examples:
    #   - If global.imageRegistry="docker.io/myorg": use "receiver" or "myorg/receiver"
    #   - If global.imageRegistry="": use "docker.io/myorg/receiver" or "myorg/receiver"
    repository: "myorg/receiver"
    tag: "latest"
    # Override global image pull policy for this service
    pullPolicy: ""
    # Override global image pull secrets for this service
    pullSecrets: []
  replicaCount: 1
  service:
    type: ClusterIP
    port: 8000
  env:
    - name: OTEL_SERVICE_NAME
      value: "receiver-service"
    - name: ERROR_RATE
      value: "0.0"
    - name: LATENCY_MS
      value: "0"
    - name: PROCESSING_TIME_MS
      value: "100"
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

# Load generator configuration (Locust)
# Single loadgen pod that sends load to the sender service
loadgen:
  enabled: false  # Disabled by default - enable when needed
  name: loadgen
  image:
    repository: "myorg/loadgen"
    tag: "latest"
    pullPolicy: ""
    pullSecrets: []
  # Deployment mode: "deployment" for long-running with web UI, "job" for one-time runs
  mode: "deployment"  # or "job"
  # For deployment mode
  replicaCount: 1
  service:
    type: ClusterIP
    port: 8089
  # For job mode (one-time execution)
  job:
    users: 10  # Number of concurrent users
    spawnRate: 2  # Users to spawn per second
    runTime: "5m"  # Duration (e.g., "5m", "1h", "30s")
  env:
    - name: TARGET_HOST
      value: "http://sender:8000"  # Sends load to sender service only
    - name: USERS
      value: "10"
    - name: SPAWN_RATE
      value: "2"
    - name: RUN_TIME
      value: "5m"
    - name: OTEL_SERVICE_NAME
      value: "loadgen-service"
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 200m
      memory: 256Mi

